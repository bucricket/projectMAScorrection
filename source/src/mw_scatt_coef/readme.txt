MIE TABLE GENERATION FOR RTTOV-SCATT   

12-Sep-2013 

Introduction
------------

The Mie tables for use with RTTOV 11 RTTOV-SCATT contain pre-computed bulk-scattering
properties (extinction, single scattering albedo and asymmetry) as a function of
temperature, water content, and channel, for a variety of hydrometeor types.
There is a Mie table for each different sensor. 

Mie tables can be generated by running the script "mie_table_generation.ksh" from the 
directory containing the mie table generation software (src/mw_scatt_coef). All 
configuration  and input is specified in the file "channels.dat", which should be 
in the same directory. This enables you to configure:

a) The output directory for the Mie files (which are very large, i.e. 50MB - 200MB each)
b) Instruments, frequencies and hydrometeor types for which to generate Mie parameters
c) Some aspects of the microphysical details of the computation

There are three example files included in this distribution. Rename them to "channels.dat"
in order to use them. 

channels.dat_all   - Will generate Mie tables for most known instruments and also
                     (commented out) some for which no clear-sky RTTOV coefficients 
                     are available.
channels.dat_atovs - Generates the Mie tables for ATOVS instruments
channels.dat_amsua - Generates just the Mie table for AMSU-A
channels.dat_ssmis - Generates just the Mie table for SSMIS
channels.dat_smos  - SMOS coefficients need to be generated separately because Liu DDA 
                     results are not available below 3 GHz. Mie scattering is used instead.
                     Note also there are no rtcoeff files for SMOS, so all this is largely 
                     irrelevant.
channels.dat_debug - Does computations for just a single frequency, to enable rapid
                     debug. By default, "channels.dat" is a copy of this

Compilation
-----------

Please refer to the RTTOV distribution readme.txt for general compilation
instructions. 

Running the code for the first time
-----------------------------------

The Mie computations are demanding. It may take a few minutes on a single-threaded
platform to generate one Mie table and it will take quite a bit longer to generate 
all possible Mie tables. For speed (and with the right compiler) the computations 
can be run OpenMP multi-threaded (but not multi-process) on a supercomputer or 
multi-core desktop.

The following steps are needed:

1) Build RTTOV in the usual way. Then build the mw_scat_coef project using:
        make ARCH=<your architecture> mw_scatt_coef
   This will create an executable called "rttov_scatt_make_coef.exe" in the 
   RTTOV bin directory

2) Copy one of the pro-forma "channels.dat_*" files to "channels.dat" in this
   directory. On installation, "channels.dat" is already present and is the same as 
   "channels.dat_debug". This produces a rapid computation for testing purposes: Use 
   this to get the code up and running.

3) Specify an output directory in channels.dat. It is not recommended to use the
   standard RTTOV coefficients directory, because the newly create Mie tables 
   will overwrite the old. 

4a) In a single threaded environment, just run the script: 

./mie_table_generation.ksh

4b) In a supercomputer environment, submit it to your job-scheduling software 
   .e.g on the ECMWF IBM supercomputer:

llsubmit ./mie_table_generation.ksh

5) (Optional) The ASCII Mie tables can be converted to binaries to save disk space 
and to give faster read times. Use the utility "rttov_ascii2bin_scatcoeffs" whose source
code is in the mw_scatt directory, and which will be built along with RTTOV, so
it should be found as bin/rttov_ascii2bin_scatcoeffs.exe. Note that binary files are not 
usually portable between different computers.

Scientific basis
----------------

The file "channels.dat" controls many of the scientific options, though not all.
For each hydrometeor type is is possible to choose a PSD and either the use of
Mie spheres with a density formulation, or (appropriate only to frozen 
hydrometeors) DDA shapes. Not all combinations of PSD and density relation will
work together. The main scientific description of the Mie computation can be found 
in Bauer (2001).

There are an increasing variety of options for frozen hydrometeors. The 
presence of an option does not necessarily mean that it is recommended for general 
use. Petty and Huang (2010) argue "there is no basis for retaining any kind of soft 
sphere... as a model for the microwave properties of snowflakes". Clearly the field 
is moving towards more accurate approaches like the Discrete Dipole Approximation, 
but in NWP, we do not know about the microphysical details of the frozen particles. 
There is no perfect solution at the moment and the options available here reflect 
the spread of current thinking, and help demonstrate how sensitive the results can 
be to our assumptions regarding frozen particles. However, Geer and Baordo (2013)
recommend the discrete dipole sector snowflake as the best choice for the
snow hydrometeor category and that is the standard choice with RTTOV-11.

The distributed "channels.dat_*" are set with the options that were used to create 
the Mie tables that are distributed via the RTTOV website. A good initial check is 
to see whether you can reproduce some of those, at least to around 7 significant 
figures.

Scientific options
------------------

- Hydrometeor defintions -

RTTOV-SCATT expects to work with five hydrometeor types:

rain, snow, cloud water, cloud ice and totalice

Frozen particles are represented EITHER by separate snow 
and cloud ice OR the "totalice". These options are mutually 
exclusive. The Mie table generation also offers "graupel" 
and "aggregate" hydrometeor types, but these are not 
supported in RTTOV-SCATT. Hence, although it is possible to 
alter the hydrometeor defintions in channels.dat, this is not 
recommended.

- Particle size distributions -

Applicability: general

The following PSDs are available and may be applied to any hydrometeor type:

1) Modified gamma (mod_gamma_dsd.F90) 
2) Marshall-Palmer / gamma (gamma_dsd.F90)
3) Field et al. (2005; predict_psd.F90) 
4) Field et al. (2007; predict_psd_F07.F90)

Documentation of the precise settings is best left to the code itself. The gamma
and modified gamma PSDs are not compatible with some choices of density 
distribution, simply because we have not yet coded up all the maths required. 
Incompatible choices will raise an error message. Some combinations of PSD 
and particle shape or density may also generate an error if they imply excessive
amounts of particles in the smallest size bin - this warning is: 

"Renormalisation of greater than 200% suggests a fundamental size distribution 
problem"

This issue is most prevalent for Liu shapes where the size ranges for which 
optical properties are available also implies a certain range of size bins.

The Panegrossi et al. (1998) n0 vs T formulation can optionally be switched on 
for the Marshall-Palmer and gamma distribution. This parametrisation modifies 
n0 in the distribution to account for the general observation 
that there are more and smaller particles at colder temperatures and fewer at 
warmer temperatures. n0 itself is set in mod_mie.F90, as is the parameter "mue", 
which is normally set to zero to provide a Marshall-Palmer distribution.

- Density formulations - 

Applicability: Mie spheres

The following density distributions are available:

1) 0.132*D-1 (Wilson & Ballard, 1999) 
2) 8.74E-4*exp(-0.625D2) + 4.5E-5 (Jones, 1995) 
3) 0.035*D-1.1 (Brown & Francis, 1995) 
4) Constant density as defined in mod_mie.F90
5) Parameterization of density vs frequency from Surussavadee et al. (2006)

Options 1-3 were explored by Doherty et al. (2007) for ice particles (the
Met Office totalice hydrometeor type). Option 4 has been the standard choice
in RTTOV-SCATT for rain, snow, cloud water and cloud ice. 

Option 5, the Surussavadee and Staelin (2006)  approach uses ad-hoc 
modifications to the density of the frozen Mie sphere. They produced an 
"ice factor" density scaling that is a function of frequency. This aims 
to get scattering properties from the Mie sphere approach that are 
similar to DDA simulations for equal-mass snow or graupel particles. 

Density options are used in a number of areas in the Mie code (e.g. in the 
computation of permittivity and in the size distributions). See density_all.F90 
for more documentation.

- Liu (2008) DDA database -

Applicability: frozen hydrometeors

Liu computed bulk scattering properties for randomly-oriented frozen particles using
a DDA approach, and provided the results in the form of a database, available
from http://cirrus.met.fsu.edu/research/scatdb.html (now included with the
RTTOV package). 11 different particle habits were simulated (e.g. columns, plates, 
rosettes, and snowflakes). To use this in RTTOV, you must select one of these
habits (mixtures are not yet available). The DDA database has been implemented here
following the approach of Kulie et al (2010). The particle shape defines the mass-
density relation, so when a Liu DDA shape is used, the density option is ignored. 
Shapes are:

-1 = Do not use DDA shapes but Mie spheres instead
0  = long column
1  = short column
2  = block column
3  = thick plate
4  = thin plate
5  = 3-bullet rosette
6  = 4-bullet rosette
7  = 5-bullet rosette
8  = 6-bullet rosette
9  = sector snowflake
10 = dendrite snowflake

- Melting layer - 

Applicability: snow, graupel, aggregate 

Implements the melting layer of Bauer (2001). This is a layer of enhanced scattering
caused by water-coated frozen particles, and it exists only in the 273.15K 
temperature bin. Computations are always made using Mie spheres; other 
microphysical assumptions are also fixed and have been described in the paper.

References
----------

P. Bauer (2001). Atmospheric Research, 57, 9-30
 Including a melting layer in microwave radiative transfer simulation for clouds.

P. Bauer (2002). NWP SAF Document No. NWPSAF-EC-TR-005
 Microwave Radiative transfer modelling in clouds and precipitation.

P. R. A. Brown, P. N. Francis (1995). J. Atmos. Oceanic Technology. 12, 410-414
 Improved Measurements of the ice water content in cirrus using a total-water probe.

A. M. Doherty, T. R. Sreerekha, U. M. O'Keeffe, S. J. English (2007). Q. J. R. Meteorol. Soc. 133, 1205-1212
 Ice Hydrometeor Microphysical Assumptions in Radiative Transfer Models at AMSU-B Frequencies. 

P. R. Field, R. J. Hogan, P. R. A. Brown, A. J. Illingworth, T. W. Choularton, R. J. Cotton (2005). Q. J. R. Meteorol. Soc. 131, 1997-2017
 Parameterization of ice-particle size distributions for mid-latitude stratiform cloud.

D. C. Jones (1995). PhD Thesis, University of Reading, Department of Meteorology
 Validation of scattering microwave radiative transfer models using an aircraft radiometer and ground based radar.

D. R. Wilson, S. P. Ballard (1999). Q. J. R. Meteorol. Soc. 125, 557, 1607-1636
 A Microphysically based precipitation scheme for the meteorological office unified model.

G. Liu (2008). Bull. Am. Met. Soc., 89, 1563-1570
 A database of microwave single-scattering properties for nonspherical ice particles. 
 (see also http://cirrus.met.fsu.edu/research/scatdb.html)

G. W. Petty, W. Huang, (2010) J. Atmos. Sci., 67, 769-787
 Microwave backscatter and extinction by soft ice spheres and complex snow aggregates
 
M. S. Kulie, R. Bennartz, T. J. Greenwald, Y. Chen, F. Weng, (2010) J. Atmos. Sci, 67, 3471-3487
 Uncertainties i micrwave properties of frozen precipitation: Implications for remote sensing and data assimilation

A. J. Geer and F. Baordo (2013), to be submitted to Atmos. Meas. Tech.
Improved scattering radiative transfer for frozen hydrometeors at microwave frequencies